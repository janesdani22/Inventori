<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
  Sistem Informasi Inventory Gudang Pupuk
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap" rel="stylesheet"/>
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
  <!-- Header -->
  <header class="bg-green-700 text-white shadow-md">
   <div class="container mx-auto px-4 py-4 flex justify-between items-center">
    <div class="flex items-center space-x-3">
     <img alt="Logo Gudang Pupuk, gambar kotak hijau dengan simbol pupuk" class="rounded" height="40" src="https://storage.googleapis.com/a1aa/image/127a6fef-0c23-40c6-912a-5c6a2b7c5436.jpg" width="40"/>
     <h1 class="text-xl font-semibold">
      Inventory Gudang Pupuk
     </h1>
    </div>
    <nav class="hidden md:flex space-x-6 font-semibold">
     <a class="hover:text-green-300 transition" href="#dashboard">
      Dashboard
     </a>
     <a class="hover:text-green-300 transition" href="#inventory">
      Inventory
     </a>
     <a class="hover:text-green-300 transition" href="#add-product">
      Tambah Produk
     </a>
     <a class="hover:text-green-300 transition" href="#reports">
      Laporan
     </a>
     <a class="hover:text-green-300 transition" href="#output">
      Output Gudang
     </a>
    </nav>
    <button aria-label="Toggle menu" class="md:hidden focus:outline-none focus:ring-2 focus:ring-green-300" id="menu-btn">
     <i class="fas fa-bars text-2xl">
     </i>
    </button>
   </div>
   <nav class="hidden bg-green-600 md:hidden px-4 py-2 space-y-2 font-semibold" id="mobile-menu">
    <a class="block hover:text-green-200 transition" href="#dashboard">
     Dashboard
    </a>
    <a class="block hover:text-green-200 transition" href="#inventory">
     Inventory
    </a>
    <a class="block hover:text-green-200 transition" href="#add-product">
     Tambah Produk
    </a>
    <a class="block hover:text-green-200 transition" href="#reports">
     Laporan
    </a>
    <a class="block hover:text-green-200 transition" href="#output">
     Output Gudang
    </a>
   </nav>
  </header>
  <!-- Main Content -->
  <main class="flex-grow container mx-auto px-4 py-6">
   <!-- Dashboard Section -->
   <section class="mb-10" id="dashboard">
    <h2 class="text-2xl font-semibold mb-4 text-green-800">
     Dashboard
    </h2>
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
     <div class="bg-white rounded-lg shadow p-6 flex items-center space-x-4">
      <div class="bg-green-100 text-green-700 p-3 rounded-full">
       <i class="fas fa-boxes fa-2x">
       </i>
      </div>
      <div>
       <p class="text-sm font-medium text-gray-500">
        Total Produk
       </p>
       <p class="text-2xl font-bold text-green-800" id="total-products">
        0
       </p>
      </div>
     </div>
     <div class="bg-white rounded-lg shadow p-6 flex items-center space-x-4">
      <div class="bg-green-100 text-green-700 p-3 rounded-full">
       <i class="fas fa-warehouse fa-2x">
       </i>
      </div>
      <div>
       <p class="text-sm font-medium text-gray-500">
        Total Stok
       </p>
       <p class="text-2xl font-bold text-green-800" id="total-stock">
        0
       </p>
      </div>
     </div>
     <div class="bg-white rounded-lg shadow p-6 flex items-center space-x-4">
      <div class="bg-green-100 text-green-700 p-3 rounded-full">
       <i class="fas fa-calendar-alt fa-2x">
       </i>
      </div>
      <div>
       <p class="text-sm font-medium text-gray-500">
        Produk Terbaru
       </p>
       <p class="text-lg font-semibold text-green-800" id="latest-product">
        -
       </p>
      </div>
     </div>
    </div>
   </section>
   <!-- Inventory Section -->
   <section class="mb-10" id="inventory">
    <h2 class="text-2xl font-semibold mb-4 text-green-800">
     Daftar Inventory Produk
    </h2>
    <div class="overflow-x-auto bg-white rounded-lg shadow">
     <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-green-100">
       <tr>
        <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">
         No
        </th>
        <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">
         Nama Produk
        </th>
        <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">
         Jenis Pupuk
        </th>
        <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">
         Stok (Kg)
        </th>
        <th class="px-6 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">
         Tanggal Masuk
        </th>
        <th class="px-6 py-3 text-center text-xs font-medium text-green-700 uppercase tracking-wider">
         Aksi
        </th>
       </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200" id="inventory-table-body">
      </tbody>
     </table>
    </div>
   </section>
   <!-- Add Product Section -->
   <section class="mb-10" id="add-product">
    <h2 class="text-2xl font-semibold mb-4 text-green-800">
     Tambah Produk Baru
    </h2>
    <form class="bg-white rounded-lg shadow p-6 max-w-lg" id="product-form">
     <div class="mb-4">
      <label class="block text-gray-700 font-semibold mb-1" for="product-name">
       Nama Produk
      </label>
      <input class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-400" id="product-name" name="productName" placeholder="Masukkan nama produk" required="" type="text"/>
     </div>
     <div class="mb-4">
      <label class="block text-gray-700 font-semibold mb-1" for="product-type">
       Jenis Pupuk
      </label>
      <select class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-400" id="product-type" name="productType" required="">
       <option disabled="" selected="" value="">
        Pilih jenis pupuk
       </option>
       <option value="Urea">
        Urea
       </option>
       <option value="ZA">
        ZA
       </option>
       <option value="SP-36">
        SP-36
       </option>
       <option value="KCL">
        KCL
       </option>
       <option value="NPK">
        NPK
       </option>
      </select>
     </div>
     <div class="mb-4">
      <label class="block text-gray-700 font-semibold mb-1" for="stock">
       Stok (Kg)
      </label>
      <input class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-400" id="stock" min="0" name="stock" placeholder="Masukkan jumlah stok" required="" type="number"/>
     </div>
     <div class="mb-4">
      <label class="block text-gray-700 font-semibold mb-1" for="entry-date">
       Tanggal Masuk
      </label>
      <input class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-400" id="entry-date" name="entryDate" required="" type="date"/>
     </div>
     <button class="bg-green-700 text-white px-5 py-2 rounded hover:bg-green-800 transition font-semibold w-full" type="submit">
      Tambah Produk
     </button>
    </form>
   </section>
   <!-- Reports Section -->
   <section class="mb-10" id="reports">
    <h2 class="text-2xl font-semibold mb-4 text-green-800">
     Laporan Stok Pupuk
    </h2>
    <div class="bg-white rounded-lg shadow p-6 max-w-4xl">
     <canvas aria-label="Grafik laporan stok pupuk" id="stockChart" role="img">
     </canvas>
    </div>
   </section>
   <!-- Output Gudang Section -->
   <section class="mb-10" id="output">
    <h2 class="text-2xl font-semibold mb-4 text-green-800">
     Output Gudang (Pengeluaran Pupuk)
    </h2>
    <form class="bg-white rounded-lg shadow p-6 max-w-lg mb-6" id="output-form">
     <div class="mb-4">
      <label class="block text-gray-700 font-semibold mb-1" for="output-product">
       Pilih Produk
      </label>
      <select class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-400" id="output-product" name="outputProduct" required="">
       <option disabled="" selected="" value="">
        Pilih produk yang akan dikeluarkan
       </option>
      </select>
     </div>
     <div class="mb-4">
      <label class="block text-gray-700 font-semibold mb-1" for="output-quantity">
       Jumlah Keluar (Kg)
      </label>
      <input class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-400" id="output-quantity" min="1" name="outputQuantity" placeholder="Masukkan jumlah pupuk yang keluar" required="" type="number"/>
     </div>
     <div class="mb-4">
      <label class="block text-gray-700 font-semibold mb-1" for="output-date">
      Tanggal Keluar
      </label>
      <input class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-400" id="output-date" name="outputDate" required="" type="date"/>
    </div>
    <button class="bg-red-700 text-white px-5 py-2 rounded hover:bg-red-800 transition font-semibold w-full" type="submit">
      Catat Output
    </button>
    </form>
    <h3 class="text-xl font-semibold mb-3 text-green-800">
    Riwayat Output Gudang
    </h3>
    <div class="overflow-x-auto bg-white rounded-lg shadow">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-red-100">
      <tr>
        <th class="px-6 py-3 text-left text-xs font-medium text-red-700 uppercase tracking-wider">
        No
        </th>
        <th class="px-6 py-3 text-left text-xs font-medium text-red-700 uppercase tracking-wider">
        Nama Produk
        </th>
        <th class="px-6 py-3 text-left text-xs font-medium text-red-700 uppercase tracking-wider">
        Jumlah Keluar (Kg)
        </th>
        <th class="px-6 py-3 text-left text-xs font-medium text-red-700 uppercase tracking-wider">
        Tanggal Keluar
        </th>
        <th class="px-6 py-3 text-center text-xs font-medium text-red-700 uppercase tracking-wider">
        Aksi
        </th>
      </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200" id="output-table-body">
      </tbody>
    </table>
    </div>
  </section>
  </main>
  <!-- Footer -->
  <footer class="bg-green-700 text-white py-4 text-center">
  <p>
    Â© 2025 Sistem Informasi Inventory Gudang Pupuk. By Janes22.
  </p>
  </footer>
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js">
  </script>
  <script>
   // Mobile menu toggle
    const menuBtn = document.getElementById('menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    menuBtn.addEventListener('click', () => {
      mobileMenu.classList.toggle('hidden');
    });

    // Inventory data array
    let inventory = [];
    // Output data array
    let outputs = [];

    // Elements
    const inventoryTableBody = document.getElementById('inventory-table-body');
    const totalProductsEl = document.getElementById('total-products');
    const totalStockEl = document.getElementById('total-stock');
    const latestProductEl = document.getElementById('latest-product');
    const productForm = document.getElementById('product-form');

    const outputForm = document.getElementById('output-form');
    const outputProductSelect = document.getElementById('output-product');
    const outputTableBody = document.getElementById('output-table-body');

    // Load inventory and outputs from localStorage if exists
    function loadData() {
      const storedInventory = localStorage.getItem('inventoryData');
      if (storedInventory) {
        inventory = JSON.parse(storedInventory);
      } else {
        inventory = [];
      }
      const storedOutputs = localStorage.getItem('outputData');
      if (storedOutputs) {
        outputs = JSON.parse(storedOutputs);
      } else {
        outputs = [];
      }
    }

    // Save inventory and outputs to localStorage
    function saveData() {
      localStorage.setItem('inventoryData', JSON.stringify(inventory));
      localStorage.setItem('outputData', JSON.stringify(outputs));
    }

    // Render inventory table
    function renderInventory() {
      inventoryTableBody.innerHTML = '';
      inventory.forEach((item, index) => {
        const tr = document.createElement('tr');
        tr.classList.add(index % 2 === 0 ? 'bg-white' : 'bg-green-50');
        tr.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${index + 1}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.productName}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.productType}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.stock}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.entryDate}</td>
          <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium space-x-2">
            <button data-index="${index}" class="edit-btn text-blue-600 hover:text-blue-900 focus:outline-none" aria-label="Edit produk ${item.productName}">
              <i class="fas fa-edit"></i>
            </button>
            <button data-index="${index}" class="delete-btn text-red-600 hover:text-red-900 focus:outline-none" aria-label="Hapus produk ${item.productName}">
              <i class="fas fa-trash-alt"></i>
            </button>
          </td>
        `;
        inventoryTableBody.appendChild(tr);
      });
      updateDashboard();
      updateChart();
      updateOutputProductOptions();
    }

    // Update dashboard stats
    function updateDashboard() {
      totalProductsEl.textContent = inventory.length;
      const totalStock = inventory.reduce((acc, item) => acc + Number(item.stock), 0);
      totalStockEl.textContent = totalStock;
      if (inventory.length > 0) {
        const latest = inventory.reduce((a, b) =>
          new Date(a.entryDate) > new Date(b.entryDate) ? a : b
        );
        latestProductEl.textContent = latest.productName;
      } else {
        latestProductEl.textContent = '-';
      }
    }

    // Clear form inputs
    function clearForm() {
      productForm.reset();
      editingIndex = null;
      productForm.querySelector('button[type="submit"]').textContent = 'Tambah Produk';
    }

    // Add or update product
    let editingIndex = null;
    productForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const productName = productForm.productName.value.trim();
      const productType = productForm.productType.value;
      const stock = Number(productForm.stock.value);
      const entryDate = productForm.entryDate.value;

      if (!productName || !productType || stock < 0 || !entryDate) {
        alert('Mohon isi semua data dengan benar.');
        return;
      }

      if (editingIndex === null) {
        // Add new product
        inventory.push({ productName, productType, stock, entryDate });
      } else {
        // Update existing product
        inventory[editingIndex] = { productName, productType, stock, entryDate };
      }

      saveData();
      renderInventory();
      clearForm();
    });

    // Handle edit and delete buttons for inventory
    inventoryTableBody.addEventListener('click', (e) => {
      if (e.target.closest('.edit-btn')) {
        const index = e.target.closest('.edit-btn').dataset.index;
        const item = inventory[index];
        productForm.productName.value = item.productName;
        productForm.productType.value = item.productType;
        productForm.stock.value = item.stock;
        productForm.entryDate.value = item.entryDate;
        editingIndex = Number(index);
        productForm.querySelector('button[type="submit"]').textContent = 'Update Produk';
        window.location.hash = '#add-product';
        productForm.productName.focus();
      } else if (e.target.closest('.delete-btn')) {
        const index = e.target.closest('.delete-btn').dataset.index;
        if (confirm(`Apakah Anda yakin ingin menghapus produk "${inventory[index].productName}"?`)) {
          // Before deleting, check if product has output records
          const productNameToDelete = inventory[index].productName;
          const hasOutput = outputs.some(o => o.productName === productNameToDelete);
          if (hasOutput) {
            if (!confirm('Produk ini memiliki riwayat output. Menghapus produk juga akan menghapus riwayat output terkait. Lanjutkan?')) {
              return;
            }
            // Remove related outputs
            outputs = outputs.filter(o => o.productName !== productNameToDelete);
          }
          inventory.splice(index, 1);
          saveData();
          renderInventory();
          renderOutput();
          if (editingIndex === Number(index)) {
            clearForm();
          }
        }
      }
    });

    // Update product options for output form
    function updateOutputProductOptions() {
      outputProductSelect.innerHTML = '<option disabled selected value="">Pilih produk yang akan dikeluarkan</option>';
      inventory.forEach((item, index) => {
        if (item.stock > 0) {
          const option = document.createElement('option');
          option.value = index;
          option.textContent = `${item.productName} (${item.productType}) - Stok: ${item.stock} Kg`;
          outputProductSelect.appendChild(option);
        }
      });
    }

    // Render output table
    function renderOutput() {
      outputTableBody.innerHTML = '';
      outputs.forEach((item, index) => {
        const tr = document.createElement('tr');
        tr.classList.add(index % 2 === 0 ? 'bg-white' : 'bg-red-50');
        tr.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${index + 1}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-red-900">${item.productName}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-red-900">${item.quantity}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-red-900">${item.outputDate}</td>
          <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium space-x-2">
            <button data-index="${index}" class="delete-output-btn text-red-600 hover:text-red-900 focus:outline-none" aria-label="Hapus output produk ${item.productName}">
              <i class="fas fa-trash-alt"></i>
            </button>
          </td>
        `;
        outputTableBody.appendChild(tr);
      });
    }

    // Handle output form submission
    outputForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const productIndex = outputProductSelect.value;
      const quantity = Number(outputForm.outputQuantity.value);
      const outputDate = outputForm.outputDate.value;

      if (productIndex === '' || quantity <= 0 || !outputDate) {
        alert('Mohon isi semua data output dengan benar.');
        return;
      }

      const product = inventory[productIndex];
      if (!product) {
        alert('Produk tidak ditemukan.');
        return;
      }

      if (quantity > product.stock) {
        alert(`Stok tidak cukup. Stok tersedia: ${product.stock} Kg.`);
        return;
      }

      // Kurangi stok produk
      product.stock -= quantity;

      // Simpan output
      outputs.push({
        productName: product.productName,
        quantity,
        outputDate,
      });

      saveData();
      renderInventory();
      renderOutput();
      outputForm.reset();
      updateOutputProductOptions();
    });

    // Handle delete output button
    outputTableBody.addEventListener('click', (e) => {
      if (e.target.closest('.delete-output-btn')) {
        const index = e.target.closest('.delete-output-btn').dataset.index;
        const outputItem = outputs[index];
        if (confirm(`Apakah Anda yakin ingin menghapus riwayat output produk "${outputItem.productName}" sebanyak ${outputItem.quantity} Kg?`)) {
          // Kembalikan stok produk
          const product = inventory.find(p => p.productName === outputItem.productName);
          if (product) {
            product.stock += outputItem.quantity;
          }
          outputs.splice(index, 1);
          saveData();
          renderInventory();
          renderOutput();
          updateOutputProductOptions();
        }
      }
    });

    // Chart.js for stock report
    let stockChart = null;
    function updateChart() {
      const ctx = document.getElementById('stockChart').getContext('2d');
      const productTypes = [...new Set(inventory.map((item) => item.productType))];
      const stockData = productTypes.map((type) => {
        return inventory
          .filter((item) => item.productType === type)
          .reduce((acc, item) => acc + Number(item.stock), 0);
      });

      if (stockChart) {
        stockChart.data.labels = productTypes;
        stockChart.data.datasets[0].data = stockData;
        stockChart.update();
      } else {
        stockChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: productTypes,
            datasets: [
              {
                label: 'Stok (Kg)',
                data: stockData,
                backgroundColor: 'rgba(34,197,94,0.7)',
                borderColor: 'rgba(21,128,61,1)',
                borderWidth: 1,
              },
            ],
          },
          options: {
            responsive: true,
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  stepSize: 10,
                },
              },
            },
            plugins: {
              legend: {
                display: true,
                labels: {
                  color: '#166534',
                  font: {
                    weight: '600',
                  },
                },
              },
              title: {
                display: true,
                text: 'Laporan Stok Pupuk Berdasarkan Jenis',
                color: '#166534',
                font: {
                  size: 18,
                  weight: '700',
                },
              },
            },
          },
        });
      }
    }

    // Initialize app
    function init() {
      loadData();
      renderInventory();
      renderOutput();
    }

    init();
  </script>
</body>
</html>